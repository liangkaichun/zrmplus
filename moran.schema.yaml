schema:
  schema_id: moran
  name: 魔然
  version: "20240115"
  author:
    - 自然碼發明人：周志農
    - 方案製作：ksqsf
  description: |
    爲傳承字設計的自然碼及輔助碼智能整句輸入方案。
  dependencies:


switches:
  - name: ascii_mode
    states: [ 中文, 西文 ]
  - name: full_shape
    states: [ 半角, 全角 ]
  - name: traditionalization
    states: [ 汉字, 漢字 ]
  - name: ascii_punct
    states: [ 。，, ．， ]
  - options: [ gbk+emoji, utf8, big5+emoji ]
    reset: 0
    states: [ GBK, UTF-8, BIG5 ]
  - name: inflexible
    states: [ 動詞, 固詞 ] # 「固詞」表示「固頂詞」
    # 默認情況下，輸入 4 碼時，會禁止碼表輸出（「動詞」模式）。
    # 這是因爲碼表最大碼長爲 4，可能會產生較低頻的多字詞，覆蓋過用戶自造的常用詞語。
    # 當固詞模式啓動後，輸入 4 碼時會優先輸出碼表中的二字詞，這些輸出帶有「⚡️」標記。
  - name: emoji
    states: [ 🈚, 🈶 ]
  - name: unicode_comment
    states: [ U關, U開 ]
  - options: [ std_opencc,  std_tw, std_hk, std_dzing ]
    states: [ 通, 臺, 港, 寍 ]

engine:
  processors:
    - key_binder
    - lua_processor@*moran_select_character # 以词定字
    - lua_processor@*moran_semicolon_processor
    - ascii_composer
    - recognizer
    - speller
    - punctuator
    - lua_processor@*moran_launcher     # 輸入 omorj 或 ogrwh 後回車打開魔然官網
    - selector
    - navigator
    - express_editor
  segmentors:
    - ascii_segmentor
    - matcher
    - abc_segmentor
    - punct_segmentor
    - fallback_segmentor
  translators:
    - punct_translator
    - table_translator@custom_phrase       # 自定義短語
    # - table_translator@english             # 英語混輸
    - lua_translator@*moran_express_translator@with_reorder # 翻譯器
    - lua_translator@*moran_shijian        # 日期orq 節氣ojq 星期oxq 時間osj
    - lua_translator@*moran_number         # 數字轉大寫
  filters:
    - lua_filter@*moran_reorder_filter
    - lua_filter@*moran_aux_hint
    - lua_filter@*moran_quick_code_hint
    - simplifier@emoji
    - charset_filter@gbk+emoji
    - charset_filter@big5+emoji
    - simplifier@std_hk
    - simplifier@std_tw
    - simplifier@std_dzing
    - simplifier
    - lua_filter@*moran_charset_comment_filter  # Unicode 區位提示
    - lua_filter@*moran_unicode_display_filter  # Unicode 編碼提示
    - uniquifier

speller:
  alphabet: abcdefghijklmnopqrstuvwxyz
  delimiter: " '"
  algebra:
    __patch:
      - moran:/algebra/user_force_top?
      - moran:/algebra/user_sentence_top?
      - moran:/algebra/generate_code
      - moran:/algebra/user_sentence_bottom?
      - moran:/algebra/user_force_bottom?

translator:    # 整句輸入模式設置，在 top_translator 中被調用
  dictionary: moran.extended
  prism: moran
  initial_quality: 5
  max_homophones: 7
  spelling_hints: 3
  contextual_suggestions: true
  preedit_format:
    - xform/([a-z][a-z][a-z][a-z])o/$1°/

custom_phrase: # 自定義短語
  dictionary: ""
  user_dict: moran_custom_phrases
  db_class: stabledb
  enable_completion: false
  enable_sentence: false
  initial_quality: 1000

english:
  dictionary: moran_english
  enable_completion: true
  enable_sentence: false
  enable_user_dict: true
  initial_quality: 1
  enable_encoder: false
  encode_commit_history: false
  comment_format:
    - xform/.*//

simplifier:
  option_name: traditionalization
  opencc_config: s2t.json

emoji:
  opencc_config: moran_emoji.json
  option_name: emoji
  tips: none

std_hk:
  opencc_config: t2hk.json
  option_name: std_hk
  #tips: all

std_tw:
  opencc_config: t2tw.json
  option_name: std_tw
  #tips: all

std_dzing:
  opencc_config: moran_dzing.json
  option_name: std_dzing
  tips: all


punctuator:
  full_shape:
    __include: default:/punctuator/full_shape  # 从 default.yaml 导入配置
  half_shape:
    __include: default:/punctuator/half_shape  # 从 default.yaml 导入配置
    
key_binder:
  import_preset: default

  # 以词定字（上屏当前词句的第一个或最后一个字）
  select_first_character: "bracketleft"
  select_last_character: "bracketright"

  bindings:
    __patch:
      - moran:/key_bindings/moran_capital_for_last_syllable
      - moran:/key_bindings/moran_tab
      - moran:/key_bindings/moran_switches
      - moran:/key_bindings/moran_semicolon_for_2
      - moran:/key_bindings/moran_apostrophe_for_3

recognizer:
  import_preset: default
  patterns:
    punct: '^/([0-9]0?|[A-Za-z]+)$'

moran:
  # 簡快碼提示符
  # 修改爲 "" 可取消提示符
  # 建議在熟悉簡碼後再取消
  quick_code_indicator: "⚡️"

  # 詞輔功能
  # 當輸入二字或三字詞時，允許詞末輸入 *一位* 輔助碼篩選詞語。
  # 例如輸入 lmjxz 得到「連接」，輸入 lmjxj 得到「鏈接」。
  # 但是與字輔輸入方法不同，詞輔在生效後 *不能* 在句末繼續輸入形成整
  # 句——這個功能僅用於「詞語篩選」。因此，這個功能僅適合習慣於以詞語
  # 爲單位輸入的用戶，因此默認是關閉的。
  #
  # 開啓後，詞輔篩選的詞語會帶有輔助碼提示，例如「鏈接」後會有「jf」，
  # 意思是輸入 j *或* f 都可以定位到這個詞，而不是說要同時輸入 jf 兩個碼
  # （相反，同時輸入 jf 兩碼後反而無法得到該選項）。
  enable_word_filter: true

  # 「出簡讓全」相關設置
  # 當一個字具有簡碼時，打其全碼（不論是 yyxx 還是 yyxxo）都會導致該
  # 字讓出首位，而被推遲到後位。
  ijrq:
    enable: true       # 是否啓用出簡讓全？
    #defer: 5          # 延遲多少位？若不設置该项，或值小於等於 0，則推遲到第二頁的首選
    show_hint: true    # 若讓全，則提示簡碼打法

  # 單字輔助碼提示
  # 注：會顯示出所有可能的輔助碼
  enable_aux_hint: false

  # 簡快碼提示（包括字和詞）
  # 例如 輸入 yy te er 英特爾 會提示「⚡yte」，即使用 yte 可以打出這個詞
  enable_quick_code_hint: false

# 默認啓用語言模型
__include: moran:/octagram/enable_for_sentence
# 若要禁用，可直接刪掉上面的 __include，或在 custom 文件中寫入：
# patch:
#   __include: moran:/octagram/disable
